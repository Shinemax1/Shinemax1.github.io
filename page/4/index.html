<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Robot Dog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="SSS">
<meta property="og:type" content="website">
<meta property="og:title" content="Robot Dog">
<meta property="og:url" content="http://shinemax1.github.io/page/4/index.html">
<meta property="og:site_name" content="Robot Dog">
<meta property="og:description" content="SSS">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Robot Dog">
<meta name="twitter:description" content="SSS">
  
    <link rel="alternative" href="/atom.xml" title="Robot Dog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/favicon.jpg" class="js-avatar">
			
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">陈旭锋</a></h1>
		</hgroup>

		
		<p class="header-subtitle">shinemax</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/Android/">Android相关</a></li>
				        
							<li><a href="/categories/iOS/">iOS相关</a></li>
				        
							<li><a href="/categories/web/">前端相关</a></li>
				        
							<li><a href="/categories/Objective-C/">Objective-C相关</a></li>
				        
							<li><a href="/categories/Others/">其它相关</a></li>
				        
							<li><a href="/categories/blog/">随笔</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Shinemax1" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/Themas" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:510360345@qq.com" title="mail">mail</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AFNetworking/" style="font-size: 11.67px;">AFNetworking</a> <a href="/tags/Animation/" style="font-size: 15px;">Animation</a> <a href="/tags/Auto-Layout/" style="font-size: 10px;">Auto Layout</a> <a href="/tags/Error/" style="font-size: 10px;">Error</a> <a href="/tags/Functional-Programming/" style="font-size: 10px;">Functional Programming</a> <a href="/tags/GCD/" style="font-size: 18.33px;">GCD</a> <a href="/tags/Git/" style="font-size: 11.67px;">Git</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/KVO/" style="font-size: 10px;">KVO</a> <a href="/tags/MVVM/" style="font-size: 10px;">MVVM</a> <a href="/tags/Objective-C/" style="font-size: 20px;">Objective-C</a> <a href="/tags/ReactiveCocoa/" style="font-size: 13.33px;">ReactiveCocoa</a> <a href="/tags/Resources/" style="font-size: 10px;">Resources</a> <a href="/tags/Runtime/" style="font-size: 16.67px;">Runtime</a> <a href="/tags/Sublime-Text/" style="font-size: 11.67px;">Sublime Text</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Transition/" style="font-size: 13.33px;">Transition</a> <a href="/tags/UIScrollView/" style="font-size: 10px;">UIScrollView</a> <a href="/tags/UIWebView/" style="font-size: 10px;">UIWebView</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/css布局/" style="font-size: 10px;">css布局</a> <a href="/tags/js基础/" style="font-size: 13.33px;">js基础</a> <a href="/tags/写作/" style="font-size: 10px;">写作</a> <a href="/tags/前端日记/" style="font-size: 10px;">前端日记</a> <a href="/tags/千字文/" style="font-size: 10px;">千字文</a> <a href="/tags/总结/" style="font-size: 10px;">总结</a> <a href="/tags/知识管理/" style="font-size: 10px;">知识管理</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">男，95年生人，Android开发工程师。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">陈旭锋</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/favicon.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">陈旭锋</h1>
			</hgroup>
			
			<p class="header-subtitle">shinemax</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/Android/">Android相关</a></li>
		        
					<li><a href="/categories/iOS/">iOS相关</a></li>
		        
					<li><a href="/categories/web/">前端相关</a></li>
		        
					<li><a href="/categories/Objective-C/">Objective-C相关</a></li>
		        
					<li><a href="/categories/Others/">其它相关</a></li>
		        
					<li><a href="/categories/blog/">随笔</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Shinemax1" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/Themas" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:510360345@qq.com" title="mail">mail</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-explicit-animations" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/26/explicit-animations/" class="article-date">
  	<time datetime="2016-06-26T02:16:26.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/explicit-animations/">显式动画</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>隐式动画</strong>是在iOS平台创建动态用户界面的一种直接方式，也是<code>UIKit</code>动画机制的基础，不过它并不能涵盖所有的动画类型。本文旨在要研究<strong>显式动画</strong>，它能够对一些属性做指定的自定义动画，或者创建非线性动画，比如沿着任意一条曲线移动。</p>
<h2 id="CAAnimation简介"><a href="#CAAnimation简介" class="headerlink" title="CAAnimation简介"></a>CAAnimation简介</h2><p>研究显式动画的关键是分析<code>CAAnimation</code>及其子类，<code>CAAnimation</code>和其子类的继承体系如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">|--CAAnimation: CAMediaTiming</div><div class="line">   |--CAPropertyAnimation</div><div class="line">      |--CABasicAnimation</div><div class="line">      |--CAKeyframeAnimation</div><div class="line">   |--CATransition</div><div class="line">   |--CAAnimationGroup</div></pre></td></tr></table></figure>
<p>一般情况下不直接使用<code>CAAnimation</code>，而使用其子类；并且<code>CAPropertyAnimation</code>也不能直接使用。</p>
<p><code>CAAnimation</code>遵循<code>CAMediaTiming</code>协议，常用属性包括：</p>
<ul>
<li><code>beginTime</code> – 控制动画开始时间，譬如<code>CACurrentMediaTime()+1.0</code>对应的是1秒的delay；</li>
<li><code>duration</code> – 控制动画的持续时间；</li>
<li><code>repeatCount</code> – 动画的重复次数，永久重复对应<code>HUGE_VALF</code>，<code>1</code>表不重复；</li>
<li><code>timingFunction</code> – 控制动画运行的节奏，一般使用<code>CAMediaTimingFunction(name:)</code>赋值，<code>name</code>可设置为：<ul>
<li><code>kCAMediaTimingFunctionLinear</code></li>
<li><code>kCAMediaTimingFunctionEaseIn</code></li>
<li><code>kCAMediaTimingFunctionEaseOut</code></li>
<li><code>kCAMediaTimingFunctionEaseInEaseOut</code></li>
<li><code>kCAMediaTimingFunctionDefault</code></li>
</ul>
</li>
<li><code>delegate</code> – 动画代理，用来监听动画的执行过程，两个方法：<ul>
<li><code>func animationDidStart(animation: CAAnimation)</code></li>
<li><code>func animationDidStop(animation: CAAnimation, finished flag: Bool)</code></li>
</ul>
</li>
<li><code>removedOnCompletion</code> – 当设置为<code>true</code>时，动画完成后，layer又会回到原处；当设置为<code>false</code>，且<code>fillMode</code>设置为<code>kCAFillModeForwards</code>时，layer动画完成后不动；</li>
<li><code>fillMode</code> – determine how the timed object behaves once its active duration has completed.</li>
</ul>
<p>额外阐述一下<code>fillMode</code>属性。在此之前先引入几个概念，经历一个完整动画的layer的时间线可分为3个部分：</p>
<ul>
<li><strong>动画前</strong> – 添加动画到动画开始前的时间段；</li>
<li><strong>动画中</strong> – 动画开始到结束的时间段；</li>
<li><strong>动画后</strong> – 动画结束后的时间；</li>
</ul>
<p>动画的实质是layer的属性值从某个值到另一个值的变化过程，站在属性值的角度同样有3个概念：</p>
<ul>
<li>origin value – 添加动画前的属性值</li>
<li>from value – 动画的初始值</li>
<li>to value – 动画的结束值</li>
</ul>
<p><code>fillMode</code>的属性值会影响layer在<strong>动画前</strong>和<strong>动画后</strong>的行为，有4种可设置的属性值：</p>
<ul>
<li><code>kCAFillModeRemoved</code> – 此为默认值，layer在<strong>动画前</strong>的属性值一直未origin value，动画开始时属性值立马切换到from value，然后动画变化到to value，动画结束时属性值又立马切换到origin value；</li>
<li><code>kCAFillModeForwards</code> – 相对于<code>kCAFillModeRemoved</code>，layer在动画结束时仍然保持属性值为to value；</li>
<li><code>kCAFillModeBackwards</code> – 相对于<code>kCAFillModeRemoved</code>，layer在动画前就将属性值切换到origin value；</li>
<li><code>kCAFillModeBoth</code> – <code>kCAFillModeForwards</code>和<code>kCAFillModeBackwards</code>的合体；</li>
</ul>
<blockquote>
<p>Note: <code>kCAFillModeForwards</code>起作用的前提是<code>removedOnCompletion</code>的属性值被设置为<code>false</code>，<code>kCAFillModeBackwards</code>的作用在delay不为0时才能直观感受到，更多内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/index.html#//apple_ref/doc/constant_group/Fill_Modes" target="_blank" rel="external">CAMediaTiming – Fill Modes</a>。</p>
</blockquote>
<p><strong>使用CAAnimation的基本套路</strong></p>
<p>使用<code>CAAnimation</code>（或者其子类）的基本套路是：</p>
<ol>
<li>初始化一个<code>CAAnimation</code>对象，并设置一些动画相关属性；</li>
<li>调用<code>CALayer#addAnimation(_:forKey:)</code>方法添加<code>CAAnimation</code>对象到<code>CALayer</code>中，这样就能开始执行动画了；</li>
<li>调用<code>CALayer#removeAnimationForKey(_:)</code>方法停止动画；</li>
</ol>
<p><code>CALayer#addAnimation(_:forKey:)</code>里的参数<code>forkey</code>没有太多别的要求，可以是任意字符串，甚至可以是<code>nil</code>。</p>
<p><strong>CAPropertyAnimation</strong></p>
<p><code>CAPropertyAnimation</code>继承<code>CAAnimation</code>，额外定义了一些属性：</p>
<ul>
<li><code>keyPath</code> – Specifies animated property. 譬如<code>&quot;frame&quot;</code>、<code>&quot;position&quot;</code>等；</li>
<li><code>additive</code> – Determines if the value of the property is the value at the end of the previous repeat cycle, plus the value of the current repeat cycle. 不太懂！</li>
<li><code>cumulative</code> – Determines if the value specified by the animation is added to the current render tree value to produce the new render tree value. 不太懂！</li>
<li><code>valueFunction</code> – An optional value function that is applied to interpolated values. 很少会用到！</li>
</ul>
<blockquote>
<p>Note: <code>CAPropertyAnimation</code>里的<code>keyPath</code>和<code>CALayer#addAnimation(_:forKey:)</code>里的<code>key</code>不一样，前者只能是<code>&quot;frame&quot;</code>、<code>&quot;position&quot;</code>之类的对应<code>CALayer</code>属性的字符串，后者可以是任意字符串，可以认为是给animation贴个ID标签。</p>
</blockquote>
<h2 id="CABasicAnimation"><a href="#CABasicAnimation" class="headerlink" title="CABasicAnimation"></a>CABasicAnimation</h2><p><code>CABasicAnimation</code>在继承<code>CAPropertyAnimation</code>的基础上又定义了三个属性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CABasicAnimation</span> : <span class="title">CAPropertyAnimation</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nullable</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> fromValue;</div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nullable</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> toValue;</div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nullable</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> byValue;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>CAAnimation.h</code>里介绍了几种使用模式，一般来说，使用<code>fromValue</code>/<code>toValue</code>或<code>fromValue</code>/<code>byValue</code>组合即可，或者直接使用<code>byValue</code>或<code>toValue</code>。</p>
<h2 id="CAKeyframeAnimation"><a href="#CAKeyframeAnimation" class="headerlink" title="CAKeyframeAnimation"></a>CAKeyframeAnimation</h2><p>Key frame animation常被翻译为：<strong>关键帧动画</strong>。顾名思义，<code>CAKeyframeAnimation</code>可以实现让animated properties按照一串数值进行动画，就好像逐帧制作动画一样。</p>
<blockquote>
<p>P.S: 不要被<code>CAKeyframeAnimation</code>中的frame所迷惑，它和<code>CALayer#frame</code>中的frame不是一回事儿。</p>
</blockquote>
<p>相较而言，<code>CABasicAnimation</code>处理动画更粗糙一些，只是单纯地让layer的属性值从a到b；考虑到<code>CAKeyframeAnimation</code>的复杂性，这一部分对它的阐述会更详细一些。</p>
<p><strong>Providing Keyframe Values</strong></p>
<p>动画处理的本质是改变属性值，<code>CABasicAnimation</code>提供了<code>fromValue</code>、<code>byValue</code>、<code>toValue</code>来「装载」待处理的属性值。</p>
<p><code>CAKeyframeAnimation</code>处理动画更精细一些，动画过程中所需要指定的属性值自然更多（一般来说），因此提供了数组类型属性<code>values</code>来「装载」待处理的属性值。</p>
<p>举个例子，现在沿正方形路径移动一个view，所经过的路径是<code>(100, 100)</code>-&gt;<code>(200, 100)</code>-&gt;<code>(200, 200)</code>-&gt;<code>(100, 200)</code>-&gt;<code>(100, 100)</code>，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> kfa = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"position"</span>)</div><div class="line"></div><div class="line">kfa.values = [<span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">100</span>)),    <span class="comment">// 左上角</span></div><div class="line">              <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">100</span>)),    <span class="comment">// 右上角</span></div><div class="line">              <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPoint</span>(x: <span class="number">200</span>, y: <span class="number">200</span>)),    <span class="comment">// 右下角</span></div><div class="line">              <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">200</span>)),    <span class="comment">// 左下角</span></div><div class="line">              <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">100</span>))]    <span class="comment">// 左上角</span></div><div class="line">kfa.duration = <span class="number">4.0</span></div><div class="line">kfa.removedOnCompletion = <span class="literal">false</span></div><div class="line">kfa.fillMode = kCAFillModeBoth</div><div class="line"></div><div class="line">animationView.layer.addAnimation(kfa, forKey: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p>除了<code>values</code>，<code>CAKeyframeAnimation</code>还提供了<code>path</code>属性，当使用<code>CAKeyframeAnimation</code>构建point-based的动画时，使用<code>path</code>是个不错的选择。</p>
<blockquote>
<p>P.S: 显然，<code>values</code>和<code>path</code>只需要使用一个即可，然而，当同时赋予<code>values</code>和<code>path</code>以有效值，哪个会起作用呢？验证发现，当给<code>path</code>设置了有效值后，<code>values</code>的值就不会起作用。</p>
</blockquote>
<p><strong>Keyframe Timing</strong></p>
<p><code>values</code>将一个完整的动画分为n个关键帧（假设数组长度为n），默认情况下，相邻帧之间的时间间隔为：duration/(n-1)。</p>
<p>但是<code>CAKeyframeAnimation</code>提供了丰富的接口以便进行更精密更丰富的自定义，相关属性包括：<code>keyTimes</code>、<code>calculationMode</code>以及<code>timingFunctions</code>。</p>
<p><code>keyTimes</code>也是数组类型，简单来说，<code>keyTimes</code>中的元素将动画时间切割成几部分，譬如<code>[0, 0.5, 1.0]</code>将时间切割为两部分：0-0.5<em>duration、0.5</em>duration-1.0*duration。</p>
<blockquote>
<p>Note: 一般来说，<code>keyTimes</code>的元素个数和<code>values</code>的元素个数一致，或者与<code>path</code>的点的个数一致，否则，动画会出现想象不到的结果；但有特殊情况，下文会提到。</p>
</blockquote>
<p><code>calculationMode</code>指示了关键帧之间的值如何计算，可选的值包括：</p>
<ul>
<li><code>kCAAnimationLinear</code>，默认值，线性过渡；</li>
<li><code>kCAAnimationDiscrete</code>，从一个关键帧跳到下一个关键帧，直接跳跃，无过渡；</li>
<li><code>kCAAnimationPaced</code></li>
<li><code>kCAAnimationCubic</code></li>
<li><code>kCAAnimationCubicPaced</code></li>
</ul>
<blockquote>
<p>P.S: <code>kCAAnimationLinear</code>和<code>kCAAnimationDiscrete</code>相对比较容易理解，后3种没怎么用到过，理解不深刻，希望以后能够补充。</p>
</blockquote>
<p>第三个属性<code>timingFunctions</code>和上文提到的<code>timingFunction</code>类似，只是这里是一个数组类型，它的每个元素控制的是两个相邻关键帧之间timing curve。</p>
<blockquote>
<p>Note: 若属性<code>values</code>中指定的关键帧个数为<code>n</code>（元素个数），则<code>timingFunctions</code>的元素个数应该为<code>n-1</code>。</p>
</blockquote>
<p>再着重介绍<code>keyTimes</code>配合<code>calculationMode</code>使用的注意事项：</p>
<ul>
<li>如果<code>calculationMode</code>的值为<code>kCAAnimationLinear</code>或<code>kCAAnimationCubic</code>，<code>keyTimes</code>的第一个元素值必须为<code>0.0</code>，最后一个元素值必须为<code>1.0</code>，其他的元素值（如果有）范围在<code>0.0-1.0</code>之间；</li>
<li>如果<code>calculationMode</code>的值为<code>kCAAnimationDiscrete</code>，<code>keyTimes</code>的第一个元素值必须为<code>0.0</code>，最后一个元素值必须为<code>1.0</code>；此外，若<code>value</code>元素个数为<code>n</code>，则<code>keyTimes</code>的元素数量应该为<code>n+1</code>；</li>
<li>如果<code>calculationMode</code>的值为<code>kCAAnimationPaced</code>或<code>kCAAnimationCubicPaced</code>，<code>keyTimes</code>的值会被忽略。</li>
</ul>
<p><strong>Rotation Mode Attribute</strong></p>
<p><code>rotationMode</code>, it determines whether objects animating along the path rotate to match the path tangent.</p>
<p>该属性配合<code>path</code>使用，有三个可选值：<code>nil</code>、<code>kCAAnimationRotateAuto</code>以及<code>kCAAnimationRotateAutoReverse</code>。设置一段曲线，配置相应的属性值，能较直观的感受到它们的作用。</p>
<p><strong>Cubic Mode Attributes</strong></p>
<p>还有三个不常用到的属性：<code>tensionValues</code>、<code>continuityValues</code>、<code>biasValues</code>。</p>
<p>它们仅在<code>calculationMode</code>属性值为<code>kCAAnimationCubic</code>或<code>kCAAnimationCubicPaced</code>时起作用。还没详细体会过，暂时略过。</p>
<p>关于<code>CAKeyframeAnimation</code>的更多内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/" target="_blank" rel="external">CAKeyframeAnimation Class Reference</a>。</p>
<h2 id="CATransition"><a href="#CATransition" class="headerlink" title="CATransition"></a>CATransition</h2><p>暂时略过，详细内容参考<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/" target="_blank" rel="external">CATransition Class Reference</a>。</p>
<p><a href="http://www.cnblogs.com/ludashi/p/4160208.html" target="_blank" rel="external">iOS开发之各种动画各种页面切面效果</a>中还介绍了更多，只是使用这些私有资源会存在被Apple Store打回的风险。</p>
<blockquote>
<p>P.S: 曾以为<code>CATransition</code>在转场动画中会用得比较多，但事实上，似乎用得并不多。</p>
</blockquote>
<h2 id="CAAnimationGroup"><a href="#CAAnimationGroup" class="headerlink" title="CAAnimationGroup"></a>CAAnimationGroup</h2><p>每个<code>CAAnimation</code>只能处理一个animated property，但有时候需要同时处理多个animated properties，此时就会用到<code>CAAnimationGroup</code>。其定义非常简单：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CAAnimationGroup</span> : <span class="title">CAAnimation</span> </span>&#123;  </div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> animations: [<span class="type">CAAnimation</span>]?</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其用法就不消多说了，easy。</p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><ul>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/" target="_blank" rel="external">CAMediaTiming Protocol Reference</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimation_class/" target="_blank" rel="external">CAAnimation Class Reference</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CABasicAnimation_class/" target="_blank" rel="external">CABasicAnimation Class Reference</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAKeyframeAnimation_class/" target="_blank" rel="external">CAKeyframeAnimation Class Reference</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CATransition_class/" target="_blank" rel="external">CATransition Class Reference</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAAnimationGroup_class/" target="_blank" rel="external">CAAnimationGroup Class Reference</a></li>
<li><a href="http://www.cnblogs.com/ludashi/p/4160208.html" target="_blank" rel="external">iOS开发之各种动画各种页面切面效果</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Animation/">Animation</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS/">iOS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-layer-geometry-in-ios" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/13/layer-geometry-in-ios/" class="article-date">
  	<time datetime="2016-06-13T11:41:36.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/layer-geometry-in-ios/">iOS图层几何学</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="frame-v-s-bounds-v-s-center"><a href="#frame-v-s-bounds-v-s-center" class="headerlink" title="frame v.s bounds v.s center"></a>frame v.s bounds v.s center</h2><p>视图（<code>UIView</code>）有三种比较重要的布局属性：<code>frame</code>，<code>bounds</code>，<code>center</code>，图层（<code>CALayer</code>）对应叫做：<code>frame</code>，<code>bounds</code>，<code>position</code>。众所周知，视图是对图层的包装，名称虽然不完全相同，但都是指向相同的值，本文中<code>position</code>和<code>center</code>表示一个意思。</p>
<p><code>bounds</code>和<code>position</code>是存储型属性，<code>bounds</code>标识了两个重要讯息：自身坐标系的起点（一般<code>(0, 0)</code>对应左上角）和图层的固有size；而<code>position</code>标识了图层中心点相对于父图层坐标系的位置。</p>
<p><code>frame</code>是计算型属性（虚拟属性），它的值根据<code>bounds</code>、<code>position</code>和<code>transform</code>计算而来。</p>
<blockquote>
<p>Note: 这里的<code>transform</code>指的是图层（<code>CALayer</code>）的<code>transform</code>属性，而不是视图的<code>transform</code>属性。<code>UIView#transform</code>是<code>CATransform3D</code>类型，而<code>CALayer#transform</code>是<code>CGAffineTransform</code>类型，虽然类型不同，但根据我的理解，视图的<code>transform</code>和其图层的<code>transform</code>直接相关，换句话说，<code>UIView#transform</code>是<code>CALayer#transform</code>的简化版。</p>
</blockquote>
<p>当<code>CALayer#transform</code>的值等于<code>CATransform3DIdentity</code>，或者当<code>UIView#transform</code>的值等于<code>CGAffineTransformIdentity</code>时，<code>frame</code>、<code>position</code>和<code>bounds</code>存在着如下关系：</p>
<ul>
<li>frame.origin = position - (bounds.size / 2.0)</li>
<li>frame.size = bounds.size</li>
</ul>
<p>在这种情况下：</p>
<ul>
<li><code>position</code>和<code>bounds</code>彼此独立，改变任意一个值不会影响另外一个；</li>
<li><code>frame.size</code>和<code>bounds.size</code>直接相关，修改任何一个会影响另外一个；</li>
<li><code>frame.origin</code>和<code>position</code>直接相关，修改任何一个会影响另外一个；</li>
<li><code>bounds.origin</code>不会对<code>frame</code>和<code>center</code>产生影响，但会影响到子图层的位置；</li>
</ul>
<p>当视图发生仿射变换时，比如平移、旋转、缩放，经验证发现：<code>position</code>和<code>bounds</code>都不会改变，而<code>frame</code>会改变。并且当对图层进行缩放时，<code>frame.size</code>会和<code>bounds.size</code>不一致，详细说明参考<a href="https://zsisme.gitbooks.io/ios-/content/chapter3/layout.html" target="_blank" rel="external">《iOS核心动画高级技巧》</a>。</p>
<blockquote>
<p>P.S: 还没测试图层3D变换时<code>bounds</code>和<code>position</code>的变化情况，但我估计结果是一样的。</p>
</blockquote>
<p>我认为：把视图和图层的<code>frame</code>属性拿掉，iOS布局系统也能照样运转，<code>frame</code>的作用不过是为了迎合大部分人的布局惯性思维罢了。</p>
<h2 id="anchorPoint"><a href="#anchorPoint" class="headerlink" title="anchorPoint"></a>anchorPoint</h2><p>按理说，图层的<code>position</code>和<code>bounds.size</code>就足以告诉布局系统它在父图层中所占据的位置和面积了，前者指示了其<strong>中心点</strong>的坐标，后者指示了其大小。</p>
<p>但问题出在<strong>中心点</strong>上，图层的<code>position</code>之所以叫<code>position</code>而不叫<code>center</code>是有原因的。</p>
<p>可以想象图层和很多其他现实物体一样，有一个<em>把柄</em>，布局系统在摆放图层时，直接“拖”着这个<em>把柄</em>，把它杵到<code>position</code>对应的坐标上即可。在大多数时候，这个<em>把柄</em>所在的位置就是图层的中心点。然而，iOS允许自定义图层的<em>把柄</em>位置，修改<code>CALayer#anchorPoint</code>值即可，<code>anchorPoint</code>是<code>CGPoint</code>类型，其默认值为<code>(0.5, 0.5)</code>（归一化值），当修改其值为<code>(0, 0)</code>，这意味着图层的<em>把柄</em>被移到左上角。换句话说，图层的<code>anchorPoint</code>属性值会影响到它的摆放位置，但该值和<code>position</code>、<code>bounds</code>彼此独立，没有任何关系，和<code>frame</code>更是谈不上啥关系了。</p>
<p>在什么时候需要修改<code>anchorPoint</code>属性值呢？<a href="https://zsisme.gitbooks.io/ios-/content/chapter3/anchor.html" target="_blank" rel="external">《ios核心动画高级技巧》</a>有一个非常不错的应用实例。</p>
<p><code>anchorPoint</code>所对应的位置，常常被称为图层的<strong>锚点</strong>。</p>
<p>更值得一提的是，视图的仿射变换和图层的3D变换，都是围绕图层的锚点进行的。</p>
<p>具体来说，当<code>anchorPoint</code>的值为默认值时，对视图进行缩放或旋转，其中心点都不会发生迁移，如下：</p>
<div class="imagediv" style="width: 316px; height: 142px"></div>

<p>当修改两个view的<code>anchorPoint</code>属性值为<code>(0.0, 0.0)</code>后，结果如下：</p>
<div class="imagediv" style="width: 318px; height: 126px"></div>

<p>显然，此时视图的缩放和旋转都以左上角为基准点。</p>
<h2 id="Z坐标轴"><a href="#Z坐标轴" class="headerlink" title="Z坐标轴"></a>Z坐标轴</h2><p><code>UIView</code>使用的是严格的二维坐标系，而<code>CALayer</code>存在于一个三维空间中。</p>
<h2 id="Hit-Testing"><a href="#Hit-Testing" class="headerlink" title="Hit Testing"></a>Hit Testing</h2><p>在什么情况下需要使用hit testing？<br>未完待续。</p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><ul>
<li><a href="http://stackoverflow.com/questions/5361369/uiview-frame-bounds-and-center" target="_blank" rel="external">UIView frame, bounds and center</a></li>
<li><a href="https://zsisme.gitbooks.io/ios-/content/" target="_blank" rel="external">iOS核心动画高级技巧</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Animation/">Animation</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS/">iOS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-non-interactive-animation-basics-in-ios" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/13/non-interactive-animation-basics-in-ios/" class="article-date">
  	<time datetime="2016-06-13T01:35:14.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/non-interactive-animation-basics-in-ios/">非交互式动画基础</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Animation-Properties"><a href="#Animation-Properties" class="headerlink" title="Animation Properties"></a>Animation Properties</h2><p>所谓的动画，其本质是物体（譬如view）的某些属性或属性组合在时间线上的变化。<a href="https://dn-motion-design.qbox.me/" target="_blank" rel="external">Motion Design for iOS</a>将这些属性总结为6种：position、opacity、color、scale、rotation、3D。</p>
<p>这种说法对iOS环境下<code>UIView</code>同样适合，<code>UIView</code>中与animation相关的属性包括：</p>
<ol>
<li><code>UIView#frame</code>/<code>UIView#center</code>/<code>UIView#bounds</code>: position</li>
<li><code>UIView#alpha</code>: alpha</li>
<li><code>UIView#backgroundColor</code>: color</li>
<li><code>UIView#transform</code>: position, scale, rotation</li>
<li><code>UIView#layer.transform</code>: 3D</li>
</ol>
<p>最后一个，<code>UIView#layer.transform</code>的类型是<code>CATransform3D</code>，能够控制layer级别的3D变换；其余几种能够控制<code>UIView</code>的2D变换，其中第4个，<code>UIView#transform</code>的类型是<code>CGAffineTransform</code>，能够控制<code>UIView</code>的平移、缩放、旋转。</p>
<p>这一部分内容着重于分析<code>CGAffineTransform</code>和<code>CATransform3D</code>，其他几个属性相对简单得多。</p>
<h2 id="Affine-Transforms"><a href="#Affine-Transforms" class="headerlink" title="Affine Transforms"></a>Affine Transforms</h2><p>国内博客在谈及<code>CGAffineTransform</code>时，常常会讲到一个词语：<strong>仿射变换</strong>，它是affine transformation的中文翻译。</p>
<p><code>CGAffineTransform</code>是个结构体类型，属于Core Graphics框架，它有6个变量：a、b、c、d、tx、ty。这6个变量和另外3个固定值构成了一个3x3矩阵，如下图：</p>
<div class="imagediv" style="width: 232px; height: 206px"></div>

<p><code>UIView</code>的本质是由像素点组成的矩形块，每个像素点的相对位置可以抽象为坐标<code>(x, y)</code>，将这个坐标称之为某像素点的<strong>原坐标</strong>，<strong>原坐标</strong>的<code>x</code>、<code>y</code>以及<code>1</code>构成一个1x3的向量<code>(x, y, 1)</code>，所谓的仿射变换指的是让该1x3向量与3x3矩阵进行相乘，得到一个新的1x3向量，称之为<code>(_x, _y, 1)</code>，而<code>(_x, _y)</code>即<code>(x, y)</code>反射变换后的新坐标。将<code>UIView</code>的每一个像素点都进行这样的处理，即可完成整个<code>UIView</code>的反射变换。更形象的描述如下图所示：</p>
<div class="imagediv" style="width: 676px; height: 220px"></div>

<p>显然，仿射变换的关键是生成<code>CGAffineTransform</code>实例了，如果没学过计算机图形学，计算<code>CGAffineTransform</code>的参数值还是蛮麻烦的，不过好在iOS已经为我们提供了快捷API。</p>
<p>仿射变换实现的效果包括平移、缩放、旋转以及它们的组合，如下是这三种仿射变换的快速生成APIs：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 平移</span></div><div class="line"><span class="type">CGAffineTransformMakeTranslation</span>(<span class="number">_</span>:<span class="number">_</span>:)</div><div class="line"><span class="comment">// CGAffineTransformMakeTranslation(tx, ty)</span></div><div class="line"></div><div class="line"><span class="comment">// 缩放</span></div><div class="line"><span class="type">CGAffineTransformMakeScale</span>(<span class="number">_</span>:<span class="number">_</span>:)</div><div class="line"><span class="comment">// CGAffineTransformMakeScale(sx, sy)</span></div><div class="line"></div><div class="line"><span class="comment">// 旋转</span></div><div class="line"><span class="type">CGAffineTransformMakeRotation</span>(<span class="number">_</span>:)</div><div class="line"><span class="comment">// CGAffineTransformMakeRotation(angle)</span></div></pre></td></tr></table></figure>
<p>除此之外还有一个其他APIs，此处略过。Wiki还提供了一些常见反射变换及对应的矩阵值，如下图：</p>
<div class="imagediv" style="width: 512px; height: 683px"></div>

<blockquote>
<p>Note: 在iOS环境中，对<code>UIView</code>进行反射变换所参考的坐标点是<code>UIView.layer.archorPoint</code>，<a href="layer-geometry-in-ios.md">《iOS图层几何学》</a>里有阐述。</p>
</blockquote>
<h2 id="3D-Transforms"><a href="#3D-Transforms" class="headerlink" title="3D Transforms"></a>3D Transforms</h2><p>3D变换要复杂得多，恐怕得花很多时间才能搞清楚，暂时略过。</p>
<p><a href="https://zsisme.gitbooks.io/ios-/content/chapter5/3d-transform.html" target="_blank" rel="external">iOS核心动画高级技巧–3D变换</a>有比较好的介绍。</p>
<p><code>UIView#transform</code>和<code>UIView#layer.transform</code>的关系？将一个归位后另外一个会是啥变化？</p>
<h2 id="Planning-Animations"><a href="#Planning-Animations" class="headerlink" title="Planning Animations"></a>Planning Animations</h2><p>如何规划动画？先问自己这么几个问题：</p>
<ul>
<li>What are the initial properties of the item?</li>
<li>What are the final properties of the item?</li>
<li>How long should the animation take?</li>
<li>What’s happening while this item is animating?</li>
<li>What will happen once this item is done animating?</li>
</ul>
<h2 id="Animation-Curve-of-An-Easing-type-Motion"><a href="#Animation-Curve-of-An-Easing-type-Motion" class="headerlink" title="Animation Curve of An Easing-type Motion"></a>Animation Curve of An Easing-type Motion</h2><p>所谓的动画，无非是animation properties在时间轴上的变化过程。</p>
<p>以时间为x轴，属性值为y轴，可以构建一个二维坐标系，属性值从<code>a</code>到<code>b</code>，有无数种走向。换句话说，动画类型的丰富程度是无限的。</p>
<p>但在实际应用中，可接受的（看起来比较爽的）动画类型是不多的，其中一种类型叫：<strong>easing-type motion</strong>，一图胜千言：</p>
<div class="imagediv" style="width: 460px; height: 340px"></div>

<p>图中所展示的是4种最为常见的easing-type motion曲线，<a href="http://easings.net/zh-cn" target="_blank" rel="external">缓动函数速查表</a>里能够看到更多。</p>
<p>在iOS中使用<code>UIView.animateWithDuration(...)</code>系列方法处理动画时，可以通过设置<code>options</code>来选择对应的easing type，比如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animateWithDuration(<span class="number">0.2</span>, delay: <span class="number">0.0</span>, options: .<span class="type">CurveEaseInOut</span>, animations: &#123; <span class="comment">/*...*/</span> &#125;, completion: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p><code>options</code>可以设置结构体类型<code>UIViewAnimationOptions</code>的变量值，该类型有很多变量值，easing-type motion相关的有四个：</p>
<ul>
<li><code>CurveLinear</code>, linear</li>
<li><code>CurveEaseInOut</code>, ease in, ease out</li>
<li><code>CurveEaseIn</code>, ease in</li>
<li><code>CurveEaseOut</code>, ease out</li>
</ul>
<blockquote>
<p>Note: 这些easing curves本质上是3次贝塞尔曲线（cubic Bézier curve），通过控制4个变量可以得到各种各样的3次贝塞尔曲线，只是iOS貌似没有提供控制这些参数的API，<a href="http://cubic-bezier.com/" target="_blank" rel="external">Cubic Bezier On Line</a>提供了更为丰富的体验。</p>
</blockquote>
<h2 id="Animation-Curve-of-A-Spring-like-Motion"><a href="#Animation-Curve-of-A-Spring-like-Motion" class="headerlink" title="Animation Curve of A Spring-like Motion"></a>Animation Curve of A Spring-like Motion</h2><p>另一种动画类型叫：<strong>spring-like motion</strong>。<a href="https://dn-motion-design.qbox.me/guide-3.html" target="_blank" rel="external">这里</a>对spring-like motion有较为细致的描述，此处就不再赘述，这一部分重点在于分析控制spring-like motion的关键参数。</p>
<p>参考<a href="https://dn-motion-design.qbox.me/guide-3.html" target="_blank" rel="external">Natural Motion</a>的分析，控制spring-like motion的关键参数有三个：</p>
<ul>
<li><strong>Mass</strong>. The mass is the weight or heft of the object attached to the end of the spring.</li>
<li><strong>stiffness.</strong> The stiffness is how difficult it is to stretch out the spring, which typically corresponds to its thickness and how tightly it’s coiled. </li>
<li><strong>damping.</strong> The damping is the resistive force or friction, like when you drag your hand through water and feel the forces pushing against it as you try to move quicker through the water.</li>
</ul>
<p>iOS自iOS 7起引入了支持spring-like motion的API：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animateWithDuration(duration: <span class="type">NSTimeInterval</span>,</div><div class="line">                           delay: <span class="type">NSTimeInterval</span>, </div><div class="line">                           usingSpringWithDamping dampingRatio: <span class="type">CGFloat</span>,</div><div class="line">                           initialSpringVelocity velocity: <span class="type">CGFloat</span>,</div><div class="line">                           options: <span class="type">UIViewAnimationOptions</span>,</div><div class="line">                           animations: () -&gt; <span class="type">Void</span>,</div><div class="line">                           completion: ((<span class="type">Bool</span>) -&gt; <span class="type">Void</span>)?)</div></pre></td></tr></table></figure>
<p>相对而言，该Spring Animation API对spring-like motion的控制简化了，只提供了两个参数：<code>dampingRatio</code>和<code>velocity</code></p>
<p><code>dampingRatio</code>的取值范围是0.0-1.0，数值越小，「弹簧」的震动效果越明显。下图演示了在<code>dampingRatio</code>为<code>0.0</code>的情况下，<code>dampingRatio</code>分别取<code>0.2</code>，<code>0.5</code>和<code>1.0</code>的情况。</p>
<div class="imagediv" style="width: 314px; height: 321px"></div>

<p><code>velocity</code>表示初识的速度，数值越大一开始移动越快。下图演示了在<code>dampingRatio</code>为<code>1.0</code>时，<code>velocity</code>分别取<code>5.0</code>，<code>15.0</code>和<code>25.0</code>的情况。值得注意的是，初始速度取值较高而时间较短时，也会出现反弹情况。</p>
<div class="imagediv" style="width: 314px; height: 321px"></div>

<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><ul>
<li><a href="https://dn-motion-design.qbox.me/" target="_blank" rel="external">Motion Design for iOS</a></li>
<li><a href="http://www.jianshu.com/p/6c09d138b31d" target="_blank" rel="external">iOS仿射变换CGAffineTransform详解</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2" target="_blank" rel="external">仿射变换</a></li>
<li><a href="https://zsisme.gitbooks.io/ios-/content/chapter5/affine-fransforms.html" target="_blank" rel="external">iOS核心动画高级技巧–仿射变换</a></li>
<li><a href="https://zsisme.gitbooks.io/ios-/content/chapter5/3d-transform.html" target="_blank" rel="external">iOS核心动画高级技巧–3D变换</a></li>
<li><a href="http://easings.net/zh-cn" target="_blank" rel="external">缓动函数速查表</a></li>
<li><a href="http://cubic-bezier.com/" target="_blank" rel="external">Cubic Bezier On Line</a></li>
<li><a href="https://www.renfei.org/blog/ios-8-spring-animation.html" target="_blank" rel="external">使用iOS 8 Spring Animation API创建动画</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Animation/">Animation</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS/">iOS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-navigation-transitions-in-ios" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/11/navigation-transitions-in-ios/" class="article-date">
  	<time datetime="2016-06-11T02:30:03.000Z" itemprop="datePublished">2016-06-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/11/navigation-transitions-in-ios/">Navigation Transition</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="../modal-transitions-in-ios/">Modal Transition概述</a>对自定义transition进行了简单概述，<a href="../using-uipercentdriveninteractivetransition">Using UIPercentDrivenInteractiveTransition</a>介绍了可交互转场的基本实现思路。本文旨在总结实现<strong>自定义navigation转场</strong>的基本套路。</p>
<p>此外，还对自己写的相关demo做一个汇总。</p>
<h2 id="Basic-Methods-Of-Custom-Navigation-Transition"><a href="#Basic-Methods-Of-Custom-Navigation-Transition" class="headerlink" title="Basic Methods Of Custom Navigation Transition"></a>Basic Methods Of Custom Navigation Transition</h2><p>在<code>UINavigationController</code>的基础上实现自定义custom navigation transition，只需要让自定义view controller遵循<code>UINavigationControllerDelegate</code>协议，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainViewController</span>: <span class="title">UIViewController</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    navigationController?.delegate = <span class="keyword">self</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>默认情况下，<code>UINavigationController#delegate</code>为<code>nil</code>，此时push和pop动画全部采用系统默认transition。</p>
<p><code>UINavigationControllerDelegate</code>定义了6个方法，与transition直接相关的有两个：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 为push和pop操作提供animation controller</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(navigationController: UINavigationController,</span></span></div><div class="line">  animationControllerForOperation operation: UINavigationControllerOperation,</div><div class="line">  fromViewController fromVC: UIViewController,</div><div class="line">  toViewController toVC: UIViewController)</div><div class="line">  -&gt; <span class="type">UIViewControllerAnimatedTransitioning</span>?</div><div class="line"></div><div class="line"><span class="comment">// 为push和pop操作提供interaction controller</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(</span></span></div><div class="line">  navigationController: UINavigationController,</div><div class="line">  interactionControllerForAnimationController animationController: UIViewControllerAnimatedTransitioning)</div><div class="line">  -&gt; <span class="type">UIViewControllerInteractiveTransitioning</span>?</div></pre></td></tr></table></figure>
<p>站在这两个方法的角度来看，<code>UINavigationControllerDelegate</code>有点类似于<code>UIViewControllerTransitioningDelegate</code>，后者为transition动画提供animation controller和interaction controller，前者的作用也类似。</p>
<h2 id="Some-Demos"><a href="#Some-Demos" class="headerlink" title="Some Demos"></a>Some Demos</h2><p><strong>可交互的简单push/pop实现 – 仿知乎</strong></p>
<!-- <div class="imagediv" style="width: 320px; height: 566px"></div> –&gt;
<p><img src="/navigation-transitions-in-ios/BasicInteractiveCustomNavigationTransitionDemo.gif" alt="ssss"></p>
<p>代码详见<a href="https://github.com/sadjason/BasicInteractiveCustomNavigationTransitionDemo">这里</a>。</p>
<p>如下是一些不错的开源custom navigation transition实现：</p>
<ul>
<li><a href="https://github.com/recruit-mp/RMPZoomTransitionAnimator">RMPZoomTransitionAnimator</a></li>
<li><a href="https://github.com/DenHeadless/ZoomInteractiveTransition">ZoomInteractiveTransition</a></li>
<li><a href="https://github.com/NewAmsterdamLabs/ZOZolaZoomTransition">ZOZolaZoomTransition</a></li>
<li><a href="https://github.com/hebertialmeida/HAPaperViewController">HAPaperViewController</a></li>
<li><a href="https://github.com/boycechang/BCMagicTransition">BCMagicTransition</a></li>
<li><a href="https://github.com/JakeLin/IBAnimatable">IBAnimatable</a></li>
</ul>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><ul>
<li><a href="http://stackoverflow.com/questions/26569488/navigation-controller-custom-transition-animation">Navigation Controller Custom Transition Animation</a></li>
</ul>
-->
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transition/">Transition</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS/">iOS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-using-uipercentdriveninteractivetransition" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/10/using-uipercentdriveninteractivetransition/" class="article-date">
  	<time datetime="2016-06-10T09:06:55.000Z" itemprop="datePublished">2016-06-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/10/using-uipercentdriveninteractivetransition/">使用UIPercentDrivenInteractiveTransition</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>实现可交互的自定义转场动画的关键在于：定义遵循<code>UIViewControllerInteractiveTransitioning</code>协议的类。</p>
<p><code>UIViewControllerInteractiveTransitioning</code>协议的内容如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UIViewControllerInteractiveTransitioning</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startInteractiveTransition</span><span class="params">(transitionContext: UIViewControllerContextTransitioning)</span></span></div><div class="line">    </div><div class="line">    <span class="keyword">optional</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">completionSpeed</span><span class="params">()</span></span> -&gt; <span class="type">CGFloat</span></div><div class="line">    <span class="keyword">optional</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">completionCurve</span><span class="params">()</span></span> -&gt; <span class="type">UIViewAnimationCurve</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到现在我都没搞明白如何定义遵循<code>UIViewControllerInteractiveTransitioning</code>的类。</p>
<p>但正如Apple<a href="https://developer.apple.com/library/prerelease/content/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html" target="_blank" rel="external">文档</a>所言：</p>
<blockquote>
<p>The easiest way to make your animations interactive is to use a <code>UIPercentDrivenInteractiveTransition</code> object.</p>
</blockquote>
<p>简单来说，创建遵循<code>UIViewControllerInteractiveTransitioning</code>协议的类型的最简单方式是继承<code>UIPercentDrivenInteractiveTransition</code>类。</p>
<p>这是一个遵循<code>UIViewControllerInteractiveTransitioning</code>协议的类，为我们预先实现和提供了一系列便利的方法，可以用一个百分比来控制交互式切换的过程。</p>
<p>该类的内容及介绍如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UIPercentDrivenInteractiveTransition</span> : <span class="title">NSObject</span>, <span class="title">UIViewControllerInteractiveTransitioning</span> </span>&#123;</div><div class="line">    </div><div class="line">  <span class="comment">// 只读，对应的是animation controller的transitionDuration(_:)返回值</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> duration: <span class="type">CGFloat</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">    </div><div class="line">  <span class="comment">// 交互动画完成度（百分比），updateInteractiveTransition(_:)会改变该值</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> percentComplete: <span class="type">CGFloat</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">    </div><div class="line">  <span class="comment">// 影响completion animation duration，一般设置为1.0（默认值），</span></div><div class="line">  <span class="comment">// 对应的completion animation duration为(1 - percentComplete)*duration.</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> completionSpeed: <span class="type">CGFloat</span></div><div class="line">    </div><div class="line">  <span class="comment">// completion animation的timing curve，默认是.EaseInOut</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> completionCurve: <span class="type">UIViewAnimationCurve</span></div><div class="line"></div><div class="line">  <span class="comment">/* 这三个方法在gesture recognizer的处理逻辑中调用 */</span></div><div class="line">  <span class="comment">// 更新百分比，一般通过手势识别的长度之类的来计算一个值，然后进行更新</span></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">updateInteractiveTransition</span><span class="params">(percentComplete: CGFloat)</span></span></div><div class="line">  <span class="comment">// 报告交互取消，返回切换前的状态</span></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">cancelInteractiveTransition</span><span class="params">()</span></span></div><div class="line">  <span class="comment">// 报告交互完成，更新到切换后的状态</span></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">finishInteractiveTransition</span><span class="params">()</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>UIPercentDrivenInteractiveTransition</code>的内容并不复杂，使用时需要注意的是，interaction controller不能孤立存在，需要配合animation controller工作；换句话说，具体的transition仍然在animation controller的<code>animateTransition(_:)</code>中完成。</p>
<p>此外，在定义animation controller的<code>animateTransition(_:)</code>方法时，不要忘记调用<code>UIViewControllerContextTransitioning</code>的<code>completeTransition(_:)</code>方法。</p>
<blockquote>
<p>P.S: 根据我的理解并验证，<code>UIViewControllerContextTransitioning#completeTransition(true)</code>的作用效果之一是将from view从container view中移除掉。</p>
</blockquote>
<p>基于<code>UIPercentDrivenInteractiveTransition</code>做了个简单的Demo，如下图：</p>
<div class="imagediv" style="width: 320px; height: 568px"></div>

<p>代码详见<a href="https://github.com/sadjason/ShrinkingModalInteractiveTransitionDemo" target="_blank" rel="external">Github</a>。</p>
<p><code>UIViewControllerTransitioning.h</code>中对<code>UIPercentDrivenInteractiveTransition</code>有一段说明，不是特别理解：</p>
<blockquote>
<p>This style of interaction controller should only be used with an animator that implements a CA style transition in the animator’s animateTransition: method.</p>
</blockquote>
<p>掌握使用<code>UIPercentDrivenInteractiveTransition</code>并不难，但是该类有哪些限制（或缺陷）呢？我有该如何抛开该类自定义实现interaction controller呢？</p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><ul>
<li><a href="https://onevcat.com/2013/10/vc-transition-in-ios7/" target="_blank" rel="external">WWDC 2013 Session笔记 - iOS7中的ViewController切换</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewControllerInteractiveTransitioning_protocol/" target="_blank" rel="external">UIViewControllerInteractiveTransitioning Protocol Reference</a></li>
<li><a href="http://initwithfunk.com/blog/2014/05/22/interactive-animated-transitions-on-ios/" target="_blank" rel="external">Interactive Animated Transitions on iOS</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transition/">Transition</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS/">iOS</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 陈旭锋
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>